<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- SEO Meta Tags -->
    <title>AroMista - Perfumería Online</title>
    <meta name="description" content="Descubre tu fragancia perfecta - Perfumes de lujo al mejor precio, entregados directamente a tu puerta. La mejor perfumería online.">
    <meta name="keywords" content="perfumes, fragancias, perfumería, online, lujo, mejor precio, entrega, aromas, colonias, eau de parfum">
    
    <!-- FAVICON AGREGADO AQUÍ -->
    <link rel="icon" href="Logo.png" type="image/png">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #D4AF37; --primary-dark: #B8941F; --secondary: #8B4B8C; --accent: #E6B800; --dark: #1A1A1A;
            --darker: #0F0F0F; --light: #F5F5F5; --success: #228B22; --warning: #DAA520; --danger: #8B0000;
            --transition: all 0.3s ease; --shadow: 0 0 15px rgba(212, 175, 55, 0.3); --shadow-lg: 0 0 25px rgba(212, 175, 55, 0.5);
            --border-radius: 8px; --bg-primary: #1A1A1A; --bg-secondary: #2A2A2A; --text-primary: #F5F5F5; --text-secondary: #C0C0C0;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; line-height: 1.6; color: var(--text-primary); background-color: var(--bg-primary); overflow-x: hidden; transition: background-color 0.3s, color 0.3s; }
        .container { width: 90%; max-width: 1200px; margin: 0 auto; }
        a { text-decoration: none; color: inherit; }
        ul { list-style: none; }
        img { max-width: 100%; display: block; }

        /* General View Class */
        .view { display: none; }
        .view.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .btn { display: inline-block; padding: 12px 24px; border: none; border-radius: var(--border-radius); cursor: pointer; font-weight: 600; transition: var(--transition); text-align: center; font-size: 1rem; position: relative; overflow: hidden; box-shadow: var(--shadow); }
        .btn::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent); transition: 0.5s; }
        .btn:hover::before { left: 100%; }
        .btn-primary { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: var(--dark); border: 1px solid var(--primary); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
        
        /* NEW/MODIFIED: WhatsApp button style for better integration */
        .btn-whatsapp-inquiry {
            background: linear-gradient(135deg, #25D366, #1DA851); /* Use a gradient for WhatsApp green */
            color: white;
            border: 1px solid #25D366;
            margin-top: 15px; /* Added some margin */
            box-shadow: var(--shadow); /* Add shadow consistent with other buttons */
        }
        .btn-whatsapp-inquiry:hover {
            transform: translateY(-2px); /* Consistent hover effect with btn-primary */
            box-shadow: var(--shadow-lg); /* Consistent hover shadow */
            background: linear-gradient(135deg, #1DA851, #25D366); /* Optional: reverse gradient or slightly darker on hover */
        }
        .btn-whatsapp-inquiry i {
            margin-right: 8px;
        }


        .header { position: fixed; top: 0; left: 0; width: 100%; background-color: rgba(26, 26, 26, 0.95); box-shadow: var(--shadow); z-index: 1000; padding: 15px 0; backdrop-filter: blur(10px); border-bottom: 1px solid rgba(212, 175, 55, 0.3); }
        .header .container { display: flex; justify-content: space-between; align-items: center; }
        .logo-img { height: 50px; width: 50px; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary); }
        .nav ul { display: flex; gap: 30px; align-items: center; }
        .nav a { font-weight: 600; position: relative; padding: 5px 0; color: var(--text-primary); transition: color 0.3s; }
        .nav a:hover { color: var(--primary); text-shadow: 0 0 8px rgba(212, 175, 55, 0.7); }
        .nav a::after { content: ''; position: absolute; bottom: 0; left: 0; width: 0; height: 2px; background: linear-gradient(90deg, var(--primary), var(--secondary)); transition: var(--transition); }
        .nav a:hover::after { width: 100%; }
        
        .nav .dropdown { position: relative; display: inline-block; }
        .nav .dropdown .dropbtn { cursor: pointer; }
        .nav .dropdown .dropbtn i { margin-left: 5px; font-size: 0.8em; transition: transform 0.3s ease; }
        .nav .dropdown-content { display: none; position: absolute; background-color: var(--bg-secondary); min-width: 180px; box-shadow: var(--shadow); z-index: 1; border-radius: var(--border-radius); border: 1px solid rgba(212, 175, 55, 0.2); margin-top: 10px; overflow: hidden; }
        .nav .dropdown-content a { color: var(--text-secondary); padding: 12px 16px; display: block; font-weight: 500; }
        .nav .dropdown-content a:hover { background-color: var(--dark); color: var(--primary); }
        .nav .dropdown-content a::after { display: none; }
        .nav .dropdown:hover .dropdown-content { display: block; animation: fadeIn 0.3s ease; }
        .nav .dropdown:hover .dropbtn i { transform: rotate(180deg); }
        .nav .dropdown:hover > a::after { width: 100%; }

        .header-actions { display: flex; gap: 15px; align-items: center; }
        .cart-btn, .user-btn { background: none; border: none; font-size: 1.3rem; cursor: pointer; position: relative; color: var(--text-primary); transition: var(--transition); width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 1px solid rgba(212, 175, 55, 0.3); }
        .cart-btn:hover, .user-btn:hover { color: var(--dark); background: linear-gradient(135deg, var(--primary), var(--primary-dark)); transform: scale(1.1); box-shadow: var(--shadow-lg); }
        .cart-count { position: absolute; top: -5px; right: -5px; background: var(--danger); color: white; font-size: 0.7rem; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 1px solid var(--dark); }
        
        /* Mobile Menu Button */
        .mobile-menu-btn { display: none; background: none; border: none; color: var(--text-primary); font-size: 1.5rem; cursor: pointer; z-index: 1100; }
        .close-nav-btn { display: none; }


        .main-content { padding-top: 80px; }
        .hero { height: 100vh; background: linear-gradient(rgba(26, 26, 26, 0.7), rgba(26, 26, 26, 0.8)), url('perfume-banner.jpg') center/cover; display: flex; align-items: center; justify-content: center; text-align: center; color: white; margin-top: -80px; position: relative; }
        .hero-content { max-width: 700px; padding: 0 20px; z-index: 2; margin-top: -100px; }
        .hero-title { font-size: 3rem; margin-bottom: 15px; text-shadow: 0 0 15px rgba(212, 175, 55, 0.7); font-weight: 800; background: linear-gradient(90deg, var(--primary), var(--secondary)); -webkit-background-clip: text; background-clip: text; color: transparent; }
        .hero-subtitle { font-size: 1.3rem; margin-bottom: 25px; font-weight: 500; color: var(--light); line-height: 1.4; }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 15px rgba(212, 175, 55, 0.4), inset 0 0 10px rgba(212, 175, 55, 0.2); }
            50% { box-shadow: 0 0 25px rgba(212, 175, 55, 0.7), inset 0 0 15px rgba(212, 175, 55, 0.3); }
        }
        @keyframes scanlines {
            from { background-position: 0 0; }
            to { background-position: 0 100px; }
        }
        .featured-banner {
            position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 900px; height: 160px;
            background: rgba(42, 42, 42, 0.9); border-radius: var(--border-radius); border: 1px solid rgba(212, 175, 55, 0.3); 
            overflow: hidden; z-index: 3; animation: pulse-glow 4s ease-in-out infinite; transition: var(--transition);
        }
        .featured-banner::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(255,255,255,0.03) 50%, rgba(255,255,255,0) 100%);
            background-size: 100% 4px; opacity: 0.5; pointer-events: none; animation: scanlines 10s linear infinite;
        }
        .banner-container { display: flex; height: 100%; transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .banner-slide { min-width: 100%; height: 100%; display: flex; align-items: center; padding: 20px; gap: 30px; }
        .banner-product-image { width: 120px; height: 120px; object-fit: contain; border-radius: var(--border-radius); flex-shrink: 0; border: 2px solid rgba(212, 175, 55, 0.5); }
        .banner-product-info { flex: 1; text-align: left; }
        .banner-product-title { font-size: 1.4rem; font-weight: 600; color: var(--primary); margin-bottom: 5px; text-shadow: 0 0 5px var(--primary); }
        .banner-product-price { font-size: 1.2rem; color: var(--success); font-weight: 700; }
        .banner-product-description { font-size: 0.9rem; color: var(--text-secondary); }
        
        .section-title { text-align: center; font-size: 2.5rem; margin-bottom: 50px; position: relative; color: var(--text-primary); font-weight: 700; text-shadow: 0 0 10px rgba(212, 175, 55, 0.5); padding-top: 80px;}
        .section-title::after { content: ''; position: absolute; bottom: -15px; left: 50%; transform: translateX(-50%); width: 80px; height: 4px; background: linear-gradient(90deg, var(--primary), var(--secondary)); border-radius: 2px; }
        
        .info-section { padding: 80px 0; background: var(--bg-secondary); }
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; text-align: center; }
        .info-card { background: var(--dark); padding: 30px; border-radius: var(--border-radius); border: 1px solid rgba(212, 175, 55, 0.2); transition: var(--transition); }
        .info-card:hover { transform: translateY(-5px); box-shadow: var(--shadow); }
        .info-card i { font-size: 2.5rem; color: var(--primary); margin-bottom: 15px; }
        .info-card h3 { font-size: 1.5rem; margin-bottom: 10px; color: var(--light); }
        .info-card p, .info-card ul { color: var(--text-secondary); line-height: 1.8; }
        .info-card li { margin-bottom: 5px; }

        .products { padding: 80px 0; }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; }
        .product-card { background: var(--bg-secondary); border-radius: var(--border-radius); overflow: hidden; box-shadow: var(--shadow); transition: var(--transition); border: 1px solid rgba(212, 175, 55, 0.2); display: flex; flex-direction: column; }
        .product-card:hover { transform: translateY(-10px); box-shadow: var(--shadow-lg); }
        .product-carousel { height: 300px; position: relative; background-color: var(--darker); overflow: hidden; }
        .carousel-container { display: flex; height: 100%; transition: transform 0.5s ease; }
        .carousel-slide { min-width: 100%; height: 100%; display:flex; align-items:center; justify-content:center; }
        .carousel-slide img { width: 100%; height: 100%; object-fit: contain; }
        .carousel-btn { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0, 0, 0, 0.5); color: var(--primary); border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; z-index: 2; }
        .carousel-btn.prev { left: 10px; } .carousel-btn.next { right: 10px; }
        .carousel-nav { position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; z-index: 2; }
        .carousel-dot { width: 10px; height: 10px; border-radius: 50%; background-color: rgba(255, 255, 255, 0.4); cursor: pointer; }
        .carousel-dot.active { background-color: var(--primary); }
        .product-info { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .product-title { font-size: 1.3rem; margin-bottom: 10px; }
        .product-description { 
            color: var(--text-secondary); 
            margin-bottom: 15px; 
            font-size: 0.9rem; 
            height: 4.2em;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }
        .product-price { font-size: 1.5rem; font-weight: 700; color: var(--primary); margin-top: auto; padding-top: 15px; }
        
        /* MODIFIED: Style for "Consultar Precio" text in product cards */
        .price-inquiry-text {
            font-size: 1.2rem;
            font-weight: 600;
            text-align: center;
            padding: 10px 0;
            margin-top: auto;
            background: linear-gradient(90deg, var(--secondary), var(--primary-dark)); /* Gradient for distinct but integrated look */
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent; /* Make text transparent so gradient shows */
            text-shadow: none; /* Remove old text-shadow */
            letter-spacing: 0.03em; /* Slight spacing */
        }

        #product-detail-view .container { padding: 40px 0; }
        #product-detail-view .product-carousel { height: 480px; }
        .product-detail-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: flex-start; }
        .product-detail-title { font-size: 2.8rem; margin-bottom: 15px; color: var(--primary); }
        .product-detail-price { font-size: 2rem; font-weight: bold; margin-bottom: 20px; }
        /* MODIFIED: Style for "Consultar Precio" in detail view */
        .product-detail-price.price-inquiry-text {
            font-size: 2.2rem;
            background: linear-gradient(90deg, var(--secondary), var(--primary-dark)); /* Apply same gradient as card */
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 10px rgba(139, 75, 140, 0.5); /* Add subtle shadow for depth */
        }
        .product-detail-description { color: var(--text-secondary); margin-bottom: 30px; line-height: 1.7; }
        .product-detail-actions .btn { width: 100%; font-size: 1.2rem; }
        .back-to-products { display: inline-block; margin-bottom: 30px; color: var(--primary); }

        .page-view { padding: 40px 0; }
        .page-content { background: var(--bg-secondary); padding: 40px; border-radius: var(--border-radius); border: 1px solid rgba(212,175,55,0.2); }
        .page-content h3 { font-size: 1.5rem; margin-bottom: 15px; color: var(--primary); }
        .page-content p, .page-content ul { margin-bottom: 15px; line-height: 1.8; color: var(--text-secondary); }
        .page-content li { margin-left: 20px; list-style: disc; }
        
        .faq-item { margin-bottom: 20px; border: 1px solid rgba(212, 175, 55, 0.2); border-radius: var(--border-radius); overflow: hidden; }
        .faq-question { background: var(--dark); padding: 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: var(--transition); }
        .faq-question:hover { background: rgba(212, 175, 55, 0.1); }
        .faq-question h4 { color: var(--primary); font-size: 1.1rem; margin: 0; }
        .faq-icon { color: var(--primary); transition: transform 0.3s ease; }
        .faq-answer { padding: 0 20px; max-height: 0; overflow: hidden; transition: all 0.3s ease; background: var(--bg-secondary); }
        .faq-answer.active { padding: 20px; max-height: 200px; }
        .faq-item.active .faq-icon { transform: rotate(180deg); }
        
        .cart-overlay, .details-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); display: flex; z-index: 2000; opacity: 0; visibility: hidden; transition: var(--transition); }
        .cart-overlay { justify-content: flex-end; }
        .details-overlay { align-items: center; justify-content: center; }
        .cart-overlay.active, .details-overlay.active { opacity: 1; visibility: visible; }
        .cart { background: var(--bg-primary); width: 100%; max-width: 450px; height: 100%; display: flex; flex-direction: column; transform: translateX(100%); transition: transform 0.3s ease; box-shadow: -5px 0 25px rgba(212, 175, 55, 0.3); border-left: 1px solid rgba(212, 175, 55, 0.3); }
        .cart-overlay.active .cart { transform: translateX(0); }
        .cart-header { padding: 20px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); display: flex; justify-content: space-between; align-items: center; }
        .close-cart { background: none; border: none; font-size: 2rem; cursor: pointer; color: var(--text-primary); }
        .cart-items { flex: 1; overflow-y: auto; padding: 20px; }
        .cart-item { display: flex; gap: 15px; padding-bottom: 15px; margin-bottom: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.1); align-items: center; }
        .cart-item-image { width: 80px; height: 80px; object-fit: contain; border-radius: var(--border-radius); flex-shrink: 0; }
        .cart-item-details { flex: 1; display: flex; flex-direction: column; }
        .cart-item-info { display: flex; justify-content: space-between; align-items: flex-start; }
        .cart-item-title { font-weight: 600; margin-bottom: 5px; }
        .cart-item-price { color: var(--primary); font-weight: 700; }
        .remove-item { background: none; border: none; color: var(--danger); cursor: pointer; font-size: 1rem; margin-left: 10px; }
        .cart-item-actions { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
        .quantity-btn { width: 30px; height: 30px; border: 2px solid; background: var(--bg-secondary); cursor: pointer; border-radius: 50%; color: white; font-weight: bold; font-size: 1rem; display: flex; align-items: center; justify-content: center; transition: var(--transition); }
        .quantity-btn.decrease { border-color: var(--danger); color: var(--danger); }
        .quantity-btn.decrease:hover { background: var(--danger); color: white; }
        .quantity-btn.increase { border-color: var(--success); color: var(--success); }
        .quantity-btn.increase:hover { background: var(--success); color: var(--dark); }
        .cart-footer { padding: 20px; border-top: 1px solid rgba(212, 175, 55, 0.3); }
        .cart-total { font-size: 1.3rem; margin-bottom: 20px; text-align: right; font-weight: 700; }
        .whatsapp-info { background: rgba(37, 211, 102, 0.1); border: 1px solid #25D366; border-radius: var(--border-radius); padding: 15px; margin-bottom: 20px; }
        .whatsapp-info p { color: var(--text-secondary); font-size: 0.9rem; margin: 0; text-align: center; }
        .whatsapp-info i { color: #25D366; margin-right: 8px; }
        
        .details-panel { background: var(--bg-primary); width: 100%; max-width: 420px; border-radius: var(--border-radius); transform: scale(0.8); transition: transform 0.3s ease; box-shadow: 0 20px 50px rgba(212, 175, 55, 0.3); border: 1px solid rgba(212, 175, 55, 0.3); margin: 20px; }
        .details-overlay.active .details-panel { transform: scale(1); }
        .details-header { padding: 20px; background: linear-gradient(90deg, var(--dark), #1a1a2e); display: flex; justify-content: space-between; align-items: center; }
        .close-details { background: none; border: none; font-size: 2rem; cursor: pointer; color: white; }
        .details-content { padding: 30px; max-height: 80vh; overflow-y: auto; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; }
        .form-group input { width: 100%; padding: 12px 15px; border: 1px solid rgba(212, 175, 55, 0.3); border-radius: var(--border-radius); background: var(--bg-secondary); color: var(--text-primary); }
        .form-group input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2); }
        
        .about { padding: 80px 0; background: var(--bg-secondary); }
        .about-content { text-align: center; max-width: 800px; margin: 0 auto; color: var(--text-secondary); line-height: 1.8;}
        .about-content p { margin-bottom: 20px; }
        .about-content span { color: var(--primary); font-weight: 600; }

        .footer { background: var(--dark); padding: 40px 0 20px; text-align: center; border-top: 1px solid rgba(0,247,255,0.2); }
        .footer-links { margin-bottom: 20px; display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
        .footer-links a { color: var(--text-secondary); transition: color 0.3s; }
        .footer-links a:hover { color: var(--primary); }

        /* NEW: Styling for the new social media icons in the footer */
        .footer-socials {
            margin-bottom: 25px;
            display: flex;
            justify-content: center;
            gap: 30px;
        }
        .footer-socials a {
            font-size: 1.8rem;
            color: var(--text-secondary);
            transition: var(--transition);
        }
        .footer-socials a:hover {
            color: var(--primary);
            transform: translateY(-3px);
            text-shadow: 0 0 8px rgba(212, 175, 55, 0.7);
        }

        .notification { position: fixed; bottom: 20px; right: 20px; background-color: var(--success); color: var(--dark); padding: 15px 25px; border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 3000; opacity: 0; transform: translateY(20px); transition: all 0.3s ease; }
        .notification.show { opacity: 1; transform: translateY(0); }
        .notification.error { background-color: var(--danger); color: white; }
        .notification.warning { background-color: var(--warning); color: var(--dark); }

        .placeholder { color: #64748b; text-align: center; padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; }
        .placeholder i { font-size: 2rem; margin-bottom: 10px; }
        
        .whatsapp-fab { position: fixed; bottom: 25px; left: 25px; z-index: 1001; }
        .whatsapp-fab a { display: flex; align-items: center; justify-content: center; background-color: #25D366; color: white; width: 60px; height: 60px; border-radius: 50%; box-shadow: 0 4px 12px rgba(0,0,0,0.4); font-size: 2.5rem; transition: all 0.3s ease; }
        .whatsapp-fab a:hover { transform: scale(1.1) rotate(10deg); box-shadow: 0 6px 16px rgba(0,0,0,0.5); }
        .whatsapp-fab .tooltip { position: absolute; left: 75px; top: 50%; transform: translateY(-50%); background-color: var(--darker); color: var(--light); padding: 8px 15px; border-radius: var(--border-radius); white-space: nowrap; opacity: 0; visibility: hidden; transition: opacity 0.3s ease; border: 1px solid rgba(0,247,255,0.3); }
        .whatsapp-fab:hover .tooltip { opacity: 1; visibility: visible; }
        @keyframes vibrate { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-2px); } 75% { transform: translateX(2px); } }
        .whatsapp-fab a { animation: vibrate 0.5s ease-in-out infinite; animation-delay: 5s; }
        .whatsapp-fab:hover a { animation: none; }

        /* MODIFIED: Styles for the new discreet curiosity card */
        #curiosity-card-container {
            position: fixed;
            z-index: 1002; /* Above FAB, below modals */
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            pointer-events: none; /* Allows clicks to pass through */
        }

        #curiosity-card-container.visible {
            opacity: 1;
            transform: scale(1);
        }

        .curiosity-card {
            background-color: var(--darker); /* Discreet dark background */
            color: var(--text-secondary); /* Light text */
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5); /* Softer shadow */
            border: 1px solid rgba(212, 175, 55, 0.3); /* Subtle border matching the theme */
            width: 250px;
            font-size: 0.9rem;
            line-height: 1.4;
            font-style: italic;
        }

        .curiosity-card::before {
            content: "\f0eb"; /* Font Awesome lightbulb icon */
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            color: var(--primary);
            margin-right: 10px;
            font-size: 1rem;
        }

        @media (max-width: 768px) {
            .nav {
                position: fixed;
                top: 0;
                left: 0;
                width: 85%;
                max-width: 320px;
                height: 100%;
                background-color: var(--bg-primary);
                box-shadow: 5px 0 20px rgba(0,0,0,0.5);
                transform: translateX(-100%);
                transition: transform 0.3s ease-in-out;
                z-index: 5000;
                padding-top: 60px;
            }
            .nav.active {
                transform: translateX(0);
            }
            .nav ul {
                display: flex;
                flex-direction: column;
                align-items: flex-start;
                gap: 0;
            }
            .nav li {
                width: 100%;
                border-bottom: 1px solid rgba(212, 175, 55, 0.1);
            }
            .nav li:first-child {
                border-top: 1px solid rgba(212, 175, 55, 0.1);
            }
            .nav a {
                padding: 18px 25px;
                display: block;
                width: 100%;
            }
            .nav a::after { display: none; }
            .nav .dropdown-content {
                display: none;
                position: static;
                background-color: var(--dark);
                box-shadow: none;
                border: none;
                border-radius: 0;
                width: 100%;
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.4s ease-in-out;
            }
            .nav .dropdown.active .dropdown-content {
                display: block;
                max-height: 500px; /* Increased max-height */
            }
            .nav .dropdown.active .dropbtn i {
                transform: rotate(180deg);
            }
            /* REMOVED problematic hover rule for mobile */
            .nav .dropdown-content a {
                padding-left: 45px;
                color: var(--text-secondary);
                font-size: 0.95em;
            }

            .mobile-menu-btn { display: block; }
            .close-nav-btn {
                display: block;
                position: absolute;
                top: 10px;
                right: 20px;
                background: none;
                border: none;
                font-size: 2.5rem;
                color: var(--text-primary);
                cursor: pointer;
            }

            .hero-title { font-size: 2.5rem; }
            .hero-subtitle { font-size: 1.2rem; }
            .section-title { font-size: 2rem; padding-top: 60px; }
            .product-detail-layout { grid-template-columns: 1fr; gap: 20px; }
            #product-detail-view .product-carousel { height: 380px; }
            .cart { max-width: 100%; }
            .details-panel { margin: 10px; max-width: calc(100% - 20px); }
            .featured-banner { width: 95%; height: 140px; bottom: 30px; }
            .banner-slide { padding: 15px; gap: 15px; }
            .banner-product-image { width: 100px; height: 100px; }
            .banner-product-title { font-size: 1.1rem; }
            .banner-product-price { font-size: 1rem; }
            .banner-product-description { font-size: 0.8rem; }
            
            .curiosity-card {
                width: 80vw; /* Use viewport width on mobile */
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <img src="Logo.png" alt="AroMista Logo" class="logo-img">
            </div>
            <nav class="nav" id="main-nav">
                <button class="close-nav-btn" id="close-nav-btn">&times;</button>
                <ul>
                    <li><a href="#inicio">Inicio</a></li>
                    <li class="dropdown">
                        <a href="#productos" class="dropbtn">Productos <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="#/productos/arabes">Árabes</a>
                            <a href="#/productos/nicho">Nicho</a>
                            <a href="#/productos/diseno">Diseño</a>
                            <a href="#/productos/amakha-paris">Amakha Paris</a>
                            <a href="#/productos/hombres">Hombres</a>
                            <a href="#/productos/mujeres">Mujeres</a>
                        </div>
                    </li>
                    <li><a href="#nosotros">Nosotros</a></li>
                    <li><a href="#/faq">FAQ</a></li>
                </ul>
            </nav>
            <div class="header-actions">
                <button class="user-btn" id="user-btn" aria-label="Datos de usuario">
                    <i class="fas fa-user"></i>
                </button>
                <button class="cart-btn" id="cart-btn" aria-label="Carrito de compras">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count">0</span>
                </button>
            </div>
            <button class="mobile-menu-btn" id="mobile-menu-btn" aria-label="Abrir menú">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <main class="main-content" id="main-container">
        <div id="main-view" class="view active">
            <section class="hero" id="inicio">
                <div class="hero-content">
                    <h2 class="hero-title">AROMISTA</h2>
                    <p class="hero-subtitle">Descubre tu fragancia perfecta - Perfumes de lujo al mejor precio, entregados directamente a tu puerta</p>
                    <a href="#productos" class="btn btn-primary">Ver Perfumes</a>
                </div>
                <div class="featured-banner" id="featured-banner">
                    <div class="banner-container" id="banner-container">
                        <!-- Banner slides will be loaded here -->
                    </div>
                </div>
            </section>
            
            <section class="info-section">
                <div class="container">
                     <div class="info-grid">
                        <div class="info-card">
                            <i class="fas fa-shipping-fast"></i>
                            <h3>Envíos Rápidos a Todo Uruguay</h3>
                            <p>Los envíos salen todos los días, de lunes a sábado. <strong>¡Sin monto mínimo de compra!</strong> Los pedidos pagos antes de las 16:00 se despachan el mismo día.</p>
                        </div>
                        <div class="info-card">
                             <i class="fas fa-credit-card"></i>
                             <h3>Formas de Pago Flexibles</h3>
                             <p>Para tu comodidad, aceptamos pagos por: Prex, Oca Blue, Mi Dinero, Mercado Pago y transferencia bancaria.</p>
                        </div>
                         <div class="info-card">
                             <i class="fas fa-headset"></i>
                             <h3>Atención Personalizada</h3>
                             <p><strong>Lunes a Viernes:</strong> 09:30 a 19:00<br><strong>Sábados:</strong> 09:30 a 13:00. ¡Consúltanos por la agencia de envío de tu preferencia!</p>
                        </div>
                     </div>
                </div>
            </section>

            <section class="about" id="nosotros">
                <div class="container">
                    <h2 class="section-title">Sobre AroMista</h2>
                    <div class="about-content">
                        <p>
                            Somos una empresa uruguaya de <span>ventas online</span>, apasionada por las fragancias y dedicada a la importación y venta de perfumes de alta calidad.
                            Nuestra misión es simple: hacer que las mejores fragancias sean accesibles para todos en Uruguay, ofreciendo precios competitivos y un servicio al cliente excepcional.
                        </p>
                        <p>
                            Creemos en la transparencia y la confianza. Por eso, gestionamos nuestros envíos con la máxima eficiencia y ofrecemos una amplia variedad de métodos de pago para adaptarnos a tus necesidades.
                        </p>
                    </div>
                </div>
            </section>
            
            <section class="products" id="productos">
                <div class="container">
                    <h2 class="section-title">Nuestros Productos</h2>
                    <div class="products-grid" id="products-container">
                        <!-- Product cards will be loaded here -->
                    </div>
                </div>
            </section>
        </div>

        <!-- Product Detail View -->
        <div id="product-detail-view" class="view">
            <!-- Product detail content will be loaded here -->
        </div>

        <!-- FAQ View -->
        <div id="faq-view" class="view">
            <h2 class="section-title">Preguntas Frecuentes</h2>
            <div class="container page-view">
                <a href="#" class="back-to-products"><i class="fas fa-arrow-left"></i> Volver a la tienda</a>
                <div class="page-content">
                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <h4>¿Cuáles son los métodos de pago disponibles?</h4>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>Aceptamos múltiples formas de pago para tu comodidad: Prex, Oca Blue, Mi Dinero, Mercado Pago y transferencia bancaria. Todos los pagos deben ser confirmados antes del envío del producto.</p>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <h4>¿Cómo funciona el proceso de compra?</h4>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>Es muy simple: agrega productos a tu carrito, completa tus datos de envío y procede al checkout. Al finalizar, serás redirigido a WhatsApp donde confirmaremos tu pedido y coordinaremos el pago y envío de manera personalizada.</p>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <h4>¿Realizan envíos a todo Uruguay?</h4>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>Sí, realizamos envíos a todo el territorio uruguayo sin monto mínimo de compra. Trabajamos con agencias como Mirtrans, Correo, Turil, Nuñez, DAC, UES o la de tu preferencia. Los envíos salen de lunes a sábado.</p>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <h4>¿Cuánto tiempo tarda en llegar mi pedido?</h4>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>Los pedidos con pago confirmado antes de las 16:00 hs se despachan el mismo día. El tiempo de entrega depende de la agencia elegida y el destino, generalmente entre 1-3 días hábiles para Montevideo y 2-5 días para el interior.</p>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <h4>¿Cómo puedo hacer seguimiento de mi pedido?</h4>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>Una vez despachado tu pedido, te enviaremos el número de seguimiento por WhatsApp. Podrás rastrear tu paquete directamente en el sitio web de la agencia de envío correspondiente.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Terms and Conditions View -->
        <div id="terms-view" class="view">
            <h2 class="section-title">Términos y Condiciones</h2>
            <div class="container page-view">
                 <a href="#" class="back-to-products"><i class="fas fa-arrow-left"></i> Volver a la tienda</a>
                <div class="page-content">
                    <h3>1. General</h3>
                    <p>Al acceder y realizar un pedido en AroMista, usted confirma que está de acuerdo y sujeto a los términos de servicio contenidos en los Términos y Condiciones que se describen a continuación. Estos términos se aplican a todo el sitio web y a cualquier correo electrónico u otro tipo de comunicación entre usted y AroMista.</p>
                    <h3>2. Productos y Precios</h3>
                    <p>Todos los productos y precios están sujetos a cambios sin previo aviso. Los precios se muestran en Pesos Uruguayos (UYU) a menos que se indique lo contrario. Nos reservamos el derecho de modificar o descontinuar un producto sin previo aviso en cualquier momento.</p>
                    <h3>3. Pagos</h3>
                    <p>Aceptamos múltiples métodos de pago, incluyendo Prex, Oca Blue, Mi Dinero, Mercado Pago y transferencias bancarias. El pago debe ser completado antes del envío del producto. La confirmación del pago puede demorar según el método elegido.</p>
                    <h3>4. Envíos</h3>
                    <p>Realizamos envíos a todo el territorio uruguayo. Los pedidos con pago confirmado antes de las 16:00 hs de lunes a sábado se despachan en el mismo día. Los costos de envío son responsabilidad del cliente, a menos que se especifique una promoción. Las agencias disponibles son Mirtrans, Correo, Turil, Nuñez, DAC, UES o la de preferencia del cliente.</p>
                </div>
            </div>
        </div>

        <!-- Privacy Policy View -->
        <div id="privacy-view" class="view">
            <h2 class="section-title">Política de Privacidad</h2>
            <div class="container page-view">
                <a href="#" class="back-to-products"><i class="fas fa-arrow-left"></i> Volver a la tienda</a>
                <div class="page-content">
                     <h3>1. Información que Recopilamos</h3>
                     <p>Recopilamos información que usted nos proporciona directamente al realizar un pedido o completar el formulario de envío. Esto incluye: nombre, dirección de correo electrónico, cédula de identidad, dirección de envío y agencia de preferencia.</p>
                     <h3>2. Cómo Usamos su Información</h3>
                     <p>La información recopilada se utiliza exclusivamente para los siguientes propósitos:</p>
                     <ul>
                        <li>Procesar y gestionar su pedido.</li>
                        <li>Coordinar el envío de sus productos.</li>
                        <li>Comunicarnos con usted sobre su compra y para la confirmación vía WhatsApp.</li>
                        <li>No compartimos su información personal con terceros para fines de marketing.</li>
                     </ul>
                      <h3>3. Seguridad de los Datos</h3>
                     <p>Nos comprometemos a proteger la seguridad de su información personal. Utilizamos una conexión segura a través de Google Apps Script para el manejo de datos y no almacenamos información sensible de pago en nuestros servidores.</p>
                </div>
            </div>
        </div>
    </main>
    <!-- END VIEWS CONTAINER -->

    <div class="cart-overlay" id="cart-overlay">
        <div class="cart">
            <div class="cart-header"><h3>Tu Carrito</h3><button class="close-cart" id="close-cart">&times;</button></div>
            <div class="cart-items" id="cart-items"></div>
            <div class="cart-footer">
                <div class="whatsapp-info">
                    <p><i class="fab fa-whatsapp"></i> Al finalizar la compra serás redirigido a WhatsApp para confirmar tu pedido de forma segura y personalizada.</p>
                </div>
                <div class="cart-total"><strong>Total: $<span id="cart-total">0.00</span></strong></div>
                <div class="cart-actions"><button class="btn btn-primary" id="checkout-btn" style="width:100%;">Proceder al Pago</button></div>
            </div>
        </div>
    </div>

    <div class="details-overlay" id="details-overlay">
        <div class="details-panel">
            <div class="details-header"><h3>Completa tus Datos de Envío</h3><button class="close-details" id="close-details">&times;</button></div>
            <div class="details-content">
                <form id="shipping-form">
                    <div class="form-group"><label for="shipping-name">Nombre Completo:</label><input type="text" id="shipping-name" required></div>
                    <div class="form-group"><label for="shipping-email">Email:</label><input type="email" id="shipping-email" required></div>
                    <div class="form-group"><label for="shipping-cedula">Cédula de Identidad:</label><input type="text" id="shipping-cedula" required></div>
                    <div class="form-group"><label for="shipping-direccion">Dirección Completa:</label><input type="text" id="shipping-direccion" required></div>
                    <div class="form-group"><label for="shipping-agencia">Agencia de Envío:</label><input type="text" id="shipping-agencia" required></div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Guardar y Proceder al Pago</button>
                </form>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-socials">
                <a href="https://www.instagram.com/aromista.uy/" target="_blank" rel="noopener noreferrer" aria-label="Instagram de AroMista">
                    <i class="fab fa-instagram"></i>
                </a>
                <a href="https://www.facebook.com/Aromista.uy/" target="_blank" rel="noopener noreferrer" aria-label="Facebook de AroMista">
                    <i class="fab fa-facebook-f"></i>
                </a>
            </div>
            <div class="footer-links">
                <a href="#/terminos">Términos y Condiciones</a>
                <a href="#/privacidad">Política de Privacidad</a>
                <a href="#/faq">Preguntas Frecuentes</a>
            </div>
            <p>© 2023 AroMista. Todos los derechos reservados.</p>
        </div>
    </footer>
    
    <div class="whatsapp-fab">
        <a href="https://wa.me/59895596779?text=Hola,%20quisiera%20hacer%20una%20consulta%20sobre%20un%20producto." target="_blank" rel="noopener noreferrer" aria-label="Contactar por WhatsApp">
            <i class="fab fa-whatsapp"></i>
        </a>
        <span class="tooltip">¿Tienes dudas? ¡Escríbenos!</span>
    </div>

    <!-- MODIFIED: Curiosity Card HTML Structure -->
    <div id="curiosity-card-container">
        <div class="curiosity-card">
            <p class="card-text"></p>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxR7zyKdQpDkjfgIpsF-sxwBJLRj7L0j0GC21AKgFx7tSY_aAwaCZMIL-GdaPCzrhLj/exec';

        let products = [];
        let customerDetails = null;
        let cart = [];
        const activeCarousels = {};
        let bannerInterval;
        let isLoadingProducts = true; 

        // DOM Elements
        const mainContainer = document.getElementById('main-container');
        const views = document.querySelectorAll('.view');
        const productsContainer = document.getElementById('products-container');
        const cartBtn = document.getElementById('cart-btn');
        const cartOverlay = document.getElementById('cart-overlay');
        const closeCart = document.getElementById('close-cart');
        const cartItems = document.getElementById('cart-items');
        const cartTotal = document.getElementById('cart-total');
        const cartCount = document.querySelector('.cart-count');
        const userBtn = document.getElementById('user-btn');
        const detailsOverlay = document.getElementById('details-overlay');
        const closeDetails = document.getElementById('close-details');
        const shippingForm = document.getElementById('shipping-form');
        const checkoutBtn = document.getElementById('checkout-btn');
        const productDetailView = document.getElementById('product-detail-view');
        const bannerContainer = document.getElementById('banner-container');
        // Mobile Menu Elements
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mainNav = document.getElementById('main-nav');
        const closeNavBtn = document.getElementById('close-nav-btn');
        // WhatsApp number (reused from FAB)
        const WHATSAPP_NUMBER = '59895596779';


        // --- Core Functions & Data Persistence ---

        /**
         * Safely gets the price from a product object.
         * Handles different possible keys ('price', 'Price', 'precio') and data types.
         * @param {object} item - The product or cart item.
         * @returns {number} The numeric price, or 0 if invalid.
         */
        function getPrice(item) {
            const priceValue = item.price || item.Price || item.precio;
            if (priceValue === null || priceValue === undefined || priceValue === '') { // Added check for empty string
                return 0;
            }
            if (typeof priceValue === 'number') {
                return priceValue;
            }
            if (typeof priceValue === 'string') {
                // Remove currency symbols, thousand separators, etc., and then parse.
                const cleanString = priceValue.replace(/[^0-9,.]/g, '').replace(',', '.');
                const numericValue = parseFloat(cleanString);
                return isNaN(numericValue) ? 0 : numericValue;
            }
            return 0;
        }

        function saveCartToLocalStorage() {
            localStorage.setItem('aroMistaCart', JSON.stringify(cart));
        }

        function loadCartFromLocalStorage() {
            const savedCart = localStorage.getItem('aroMistaCart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
            }
        }
        
        async function fetchProducts() {
            try {
                const response = await fetch(SCRIPT_URL);
                if (!response.ok) throw new Error(`Error HTTP: ${response.status}`);
                products = await response.json();

                products.forEach(product => {
                    if (product.images && Array.isArray(product.images)) {
                        product.images = product.images.map(url => {
                            if (typeof url === 'string' && url.includes('drive.google.com/file/d/')) {
                                const fileId = url.split('/d/')[1].split('/')[0];
                                return `https://drive.google.com/uc?export=view&id=${fileId}`;
                            }
                            return url;
                        }).filter(url => url);
                    }
                });

                isLoadingProducts = false; 
                handleRouteChange();
                initializeFeaturedBanner();
            } catch (error) {
                showNotification('Error al cargar productos.', 'error');
                productsContainer.innerHTML = "<p>No se pudieron cargar los productos.</p>";
                isLoadingProducts = false; 
            }
        }

        async function saveShippingDetails(e) {
            e.preventDefault();
            const details = {
                action: 'registerUser', name: document.getElementById('shipping-name').value, email: document.getElementById('shipping-email').value,
                password: 'NOT_SET', cedula: document.getElementById('shipping-cedula').value, direccion: document.getElementById('shipping-direccion').value,
                agencia: document.getElementById('shipping-agencia').value
            };
            
            showNotification('Guardando tus datos...', 'warning');
            
            try {
                await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(details) });
                customerDetails = details;
                showNotification('Datos guardados. Finalizando compra...', 'success');
                closeDetailsForm();
                redirectToWhatsApp();
            } catch (error) { 
                showNotification('No se pudieron guardar los datos. Inténtalo de nuevo.', 'error');
            }
        }
        
        // --- Featured Banner Functions ---
        function initializeFeaturedBanner() {
            if (products.length === 0) return;
            
            // Filter products with a price for the banner
            const featuredProducts = products.filter(p => getPrice(p) > 0).slice(0, 5);
            
            if (featuredProducts.length === 0) {
                document.getElementById('featured-banner').style.display = 'none'; // Hide banner if no products with price
                return;
            }

            bannerContainer.innerHTML = featuredProducts.map(product => {
                const imageUrl = (product.images && product.images[0]) ? product.images[0] : 'https://via.placeholder.com/80';
                return `
                    <div class="banner-slide">
                        <img src="${imageUrl}" class="banner-product-image" alt="${product.name}">
                        <div class="banner-product-info">
                            <div class="banner-product-title">${product.name}</div>
                            <div class="banner-product-price">$${getPrice(product).toFixed(2)}</div>
                            <div class="banner-product-description">${product.description.substring(0, 50)}...</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            let currentBannerIndex = 0;
            if (bannerInterval) clearInterval(bannerInterval);
            bannerInterval = setInterval(() => {
                currentBannerIndex = (currentBannerIndex + 1) % featuredProducts.length;
                bannerContainer.style.transform = `translateX(-${currentBannerIndex * 100}%)`;
            }, 4000);
        }
        
        // --- FAQ Functions ---
        function toggleFAQ(element) {
            const faqItem = element.parentElement;
            const answer = faqItem.querySelector('.faq-answer');
            const isActive = faqItem.classList.contains('active');
            
            document.querySelectorAll('.faq-item').forEach(item => {
                item.classList.remove('active');
                item.querySelector('.faq-answer').classList.remove('active');
            });
            
            if (!isActive) {
                faqItem.classList.add('active');
                answer.classList.add('active');
            }
        }
        
        // --- Routing and View Management ---
        function handleRouteChange() {
            const hash = location.hash || '#';
            views.forEach(view => view.classList.remove('active'));
            window.scrollTo(0, 0);

            if (hash.startsWith('#/producto/')) {
                const productId = hash.split('/')[2];
                renderProductDetail(productId);
                productDetailView.classList.add('active');
            } else if (hash.startsWith('#/productos/')) {
                const category = hash.split('/')[2];
                renderProducts(category); 
                document.getElementById('main-view').classList.add('active');
                // Scroll to products section smoothly
                setTimeout(() => {
                    document.getElementById('productos').scrollIntoView({ behavior: 'smooth' });
                }, 100);
            } else if (hash === '#/terminos') {
                document.getElementById('terms-view').classList.add('active');
            } else if (hash === '#/privacidad') {
                document.getElementById('privacy-view').classList.add('active');
            } else if (hash === '#/faq') {
                document.getElementById('faq-view').classList.add('active');
            } else {
                renderProducts(); 
                document.getElementById('main-view').classList.add('active');
                updateMetaTags();
            }
            // Close mobile nav on route change
            mainNav.classList.remove('active');
        }

        // --- Render Functions ---
        function renderProducts(filterCategory = null) {
            if (isLoadingProducts) {
                productsContainer.innerHTML = `<p class="placeholder" style="grid-column: 1 / -1;">Cargando perfumes...</p>`;
                return;
            }
            
            productsContainer.innerHTML = '';
            let productsToRender = products;

            if (filterCategory) {
                productsToRender = products.filter(p => {
                    if (!p.category) return false;
                    
                    const productCategories = p.category
                        .toLowerCase()
                        .normalize("NFD")
                        .replace(/[\u0300-\u036f]/g, "")
                        .split(',')
                        .map(c => c.trim());

                    let searchSlug = filterCategory.replace(/-/g, ' '); 
                    if (searchSlug === 'hombres') searchSlug = 'hombre';
                    if (searchSlug === 'mujeres') searchSlug = 'mujer';

                    return productCategories.includes(searchSlug);
                });
            }
            
            if (productsToRender.length === 0) {
                productsContainer.innerHTML = `<p class="placeholder" style="grid-column: 1 / -1;">No se encontraron productos en esta categoría.</p>`;
                return;
            }

            productsToRender.forEach(product => {
                const productCardLink = document.createElement('a');
                productCardLink.href = `#/producto/${product.id}`;
                productCardLink.className = 'product-card';
                productCardLink.setAttribute('aria-label', `Ver detalles de ${product.name}`);

                let carouselHTML = `<div class="placeholder"><i class="fas fa-image"></i><p>Sin imagen</p></div>`;
                if (product.images && product.images.length > 0 && product.images[0]) {
                     carouselHTML = `<div class="carousel-container">${product.images.map(img => `<div class="carousel-slide"><img src="${img}" alt="${product.name}" loading="lazy"></div>`).join('')}</div>`;
                }
                
                // NEW: Conditional price display
                const productPrice = getPrice(product);
                const priceDisplay = productPrice > 0 
                    ? `<div class="product-price">$${productPrice.toFixed(2)}</div>`
                    : `<div class="product-price price-inquiry-text">Consultar Precio</div>`;


                productCardLink.innerHTML = `
                    <div class="product-carousel">${carouselHTML}</div>
                    <div class="product-info">
                        <div>
                            <h3 class="product-title">${product.name}</h3>
                            <p class="product-description">${product.description}</p>
                        </div>
                        ${priceDisplay}
                    </div>`;
                productsContainer.appendChild(productCardLink);
            });
        }
        
        function renderProductDetail(productId) {
            const product = products.find(p => p.id == productId);
            if (!product) {
                productDetailView.innerHTML = `<div class="container"><h2 class="section-title">Producto no encontrado</h2><a href="#">Volver a la tienda</a></div>`;
                return;
            }

            updateMetaTags(product);

            let carouselHTML = `<div class="placeholder"><i class="fas fa-image"></i><p>Sin imagen</p></div>`;
            if (product.images && product.images.length > 0 && product.images[0]) {
                carouselHTML = `
                    <div class="carousel-container" id="carousel-container-${product.id}">
                        ${product.images.map(img => `<div class="carousel-slide"><img src="${img}" alt="${product.name}"></div>`).join('')}
                    </div>
                `;
                if (product.images.length > 1) {
                    carouselHTML += `
                        <button class="carousel-btn prev" onclick="changeSlide('${product.id}', -1)"><i class="fas fa-chevron-left"></i></button>
                        <button class="carousel-btn next" onclick="changeSlide('${product.id}', 1)"><i class="fas fa-chevron-right"></i></button>
                        <div class="carousel-nav" id="carousel-nav-${product.id}">
                            ${product.images.map((_, index) => `<div class="carousel-dot ${index === 0 ? 'active' : ''}" onclick="currentSlide('${product.id}', ${index})"></div>`).join('')}
                        </div>
                    `;
                }
            }
            
            const formattedDescription = product.description.replace(/\n/g, '<br>');

            // NEW: Conditional price and action button for product detail
            const productPrice = getPrice(product);
            let priceDetailDisplay;
            let actionButton;

            if (productPrice > 0) {
                priceDetailDisplay = `<div class="product-detail-price">$${productPrice.toFixed(2)}</div>`;
                actionButton = `
                    <button class="btn btn-primary btn-add-cart-detail" data-id="${product.id}">
                        <i class="fas fa-shopping-cart"></i> Agregar al Carrito
                    </button>
                `;
            } else {
                priceDetailDisplay = `<div class="product-detail-price price-inquiry-text">Consultar Precio y Disponibilidad</div>`;
                const whatsappMessage = encodeURIComponent(`Hola, quisiera consultar el precio y disponibilidad de: ${product.name} (ID: ${product.id}).`);
                actionButton = `
                    <a href="https://wa.me/${WHATSAPP_NUMBER}?text=${whatsappMessage}" target="_blank" rel="noopener noreferrer" class="btn btn-whatsapp-inquiry">
                        <i class="fab fa-whatsapp"></i> Consultar por WhatsApp
                    </a>
                `;
            }


            productDetailView.innerHTML = `
                <div class="container">
                     <a href="#" class="back-to-products"><i class="fas fa-arrow-left"></i> Volver a Productos</a>
                     <div class="product-detail-layout">
                        <div class="product-carousel">${carouselHTML}</div>
                        <div class="product-detail-info">
                            <h2 class="product-detail-title">${product.name}</h2>
                            ${priceDetailDisplay}
                            <p class="product-detail-description">${formattedDescription}</p>
                            <div class="product-detail-actions">
                                ${actionButton}
                            </div>
                        </div>
                     </div>
                </div>`;

            if (product.images && product.images.length > 1) {
                initializeCarousel(product.id);
            }
            
            // Only add event listener if the Add to Cart button is present
            if (productPrice > 0) {
                document.querySelector('.btn-add-cart-detail').addEventListener('click', (e) => {
                    addToCart(e.target.closest('button').dataset.id);
                });
            }
        }

        function updateCart() {
            saveCartToLocalStorage();
            cartCount.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
            if (cart.length === 0) {
                cartItems.innerHTML = '<p class="placeholder">Tu carrito está vacío</p>';
                cartTotal.textContent = '0.00';
                return;
            }
            let total = 0;
            cartItems.innerHTML = cart.map(item => {
                total += getPrice(item) * item.quantity;
                const itemImage = (item.images && item.images[0]) ? item.images[0] : 'https://via.placeholder.com/80';
                return `
                    <div class="cart-item" data-id="${item.id}">
                        <img src="${itemImage}" class="cart-item-image" alt="${item.name}">
                        <div class="cart-item-details">
                            <div class="cart-item-info">
                                <span class="cart-item-title">${item.name}</span>
                                <button class="remove-item" title="Eliminar">&times;</button>
                            </div>
                             <p class="cart-item-price">$${getPrice(item).toFixed(2)}</p>
                            <div class="cart-item-actions">
                                <button class="quantity-btn decrease">-</button>
                                <span>${item.quantity}</span>
                                <button class="quantity-btn increase">+</button>
                            </div>
                        </div>
                    </div>`;
            }).join('');
            cartTotal.textContent = total.toFixed(2);
        }

        // --- Carousel, UI & Helper Functions ---
        function initializeCarousel(productId) {
            if (activeCarousels[productId]) clearInterval(activeCarousels[productId]);
            activeCarousels[productId] = setInterval(() => changeSlide(productId, 1), 5000);
        }
        function changeSlide(productId, direction) {
            const container = document.getElementById(`carousel-container-${productId}`);
            const dots = document.querySelectorAll(`#carousel-nav-${productId} .carousel-dot`);
            if (!container || dots.length === 0) return;
            let currentIndex = Array.from(dots).findIndex(dot => dot.classList.contains('active'));
            let nextIndex = (currentIndex + direction + dots.length) % dots.length;
            currentSlide(productId, nextIndex);
        }
        function currentSlide(productId, index) {
            const container = document.getElementById(`carousel-container-${productId}`);
            const dots = document.querySelectorAll(`#carousel-nav-${productId} .carousel-dot`);
            if (!container || !dots[index]) return;
            container.style.transform = `translateX(-${index * 100}%)`;
            dots.forEach(dot => dot.classList.remove('active'));
            dots[index].classList.add('active');
            initializeCarousel(productId);
        }

        function addToCart(productId) {
            const product = products.find(p => p.id == productId);
            if (!product) return;
            
            // NEW: Prevent adding to cart if price is 0
            if (getPrice(product) === 0) {
                showNotification(`Este producto no tiene precio definido para agregar al carrito. Por favor, consulta directamente.`, 'warning');
                return;
            }

            const existingItem = cart.find(item => item.id == productId);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            updateCart();
            showNotification(`${product.name} agregado al carrito`, 'success');
        }

        function handleCartActions(e) {
            const itemEl = e.target.closest('.cart-item');
            if (!itemEl) return;
            const id = itemEl.dataset.id;
            const itemInCart = cart.find(item => item.id == id);
            if (!itemInCart) return;

            if (e.target.classList.contains('increase')) itemInCart.quantity++;
            else if (e.target.classList.contains('decrease')) {
                itemInCart.quantity--;
                if (itemInCart.quantity <= 0) cart = cart.filter(item => item.id != id);
            } else if (e.target.classList.contains('remove-item')) {
                cart = cart.filter(item => item.id != id);
            }
            updateCart();
        }

        function showNotification(message, type = 'success') {
            const el = document.createElement('div');
            el.className = `notification ${type}`;
            el.innerHTML = `<span>${message}</span>`;
            document.body.appendChild(el);
            setTimeout(() => el.classList.add('show'), 10);
            setTimeout(() => {
                el.classList.remove('show');
                setTimeout(() => document.body.removeChild(el), 300);
            }, 3000);
        }
        
        function checkout() {
            if (cart.length === 0) {
                showNotification('Tu carrito está vacío.', 'warning');
                return;
            }
            // Filter out items with 0 price from checkout calculation and message
            const itemsWithPrice = cart.filter(item => getPrice(item) > 0);
            if (itemsWithPrice.length === 0) {
                showNotification('Tu carrito solo contiene productos sin precio definido. Por favor, consulta por WhatsApp.', 'warning');
                // You might want to redirect to WhatsApp directly here if no priced items
                const initialMessage = encodeURIComponent(`Hola, tengo algunos productos en mi carrito sin precio. Me gustaría consultar la disponibilidad y el costo de los siguientes: ${cart.map(item => `${item.name} (ID: ${item.id})`).join(', ')}`);
                window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${initialMessage}`, '_blank');
                return;
            }

            if (!customerDetails) showDetailsForm();
            else redirectToWhatsApp();
        }

        function redirectToWhatsApp() {
            if (!customerDetails) { 
                showNotification('Por favor, completa tus datos de envío.', 'error'); 
                showDetailsForm(); 
                return; 
            }
            if (cart.length === 0) { 
                showNotification('Tu carrito está vacío.', 'warning'); 
                return; 
            }

            let message = `Hola, mi nombre es ${customerDetails.name}. Quiero confirmar mi pedido:\n\n`;
            
            // Separate items with and without price
            const itemsWithPrice = cart.filter(item => getPrice(item) > 0);
            const itemsWithoutPrice = cart.filter(item => getPrice(item) === 0);

            if (itemsWithPrice.length > 0) {
                message += "Productos con precio:\n";
                message += itemsWithPrice.map(item => `- ${item.name} (x${item.quantity}) - $${(getPrice(item) * item.quantity).toFixed(2)}`).join('\n');
                const total = itemsWithPrice.reduce((sum, item) => sum + getPrice(item) * item.quantity, 0);
                message += `\nTotal de productos con precio: $${total.toFixed(2)}`;
            }

            if (itemsWithoutPrice.length > 0) {
                if (itemsWithPrice.length > 0) {
                    message += "\n\nTambién me gustaría consultar por los siguientes productos sin precio:\n";
                } else {
                    message += "Me gustaría consultar por los siguientes productos sin precio:\n";
                }
                message += itemsWithoutPrice.map(item => `- ${item.name} (x${item.quantity})`).join('\n');
            }

            message += `\n\n--- MIS DATOS DE ENVÍO ---\nCédula: ${customerDetails.cedula}\nEmail: ${customerDetails.email}\nDirección: ${customerDetails.direccion}\nAgencia: ${customerDetails.agencia}`;
            
            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`, '_blank');
        }

        function updateMetaTags(product = null) {
            const defaultTitle = 'AroMista - Perfumería Online';
            const defaultDesc = 'La mejor perfumería online en Uruguay. Fragancias de lujo al mejor precio, entregados directamente a tu puerta.';
            if (product) {
                document.title = `${product.name} | AroMista`;
                document.querySelector('meta[name="description"]').setAttribute('content', product.description);
            } else {
                document.title = defaultTitle;
                document.querySelector('meta[name="description"]').setAttribute('content', defaultDesc);
            }
        }

        function showDetailsForm(){ detailsOverlay.classList.add('active'); }
        function closeDetailsForm(){ detailsOverlay.classList.remove('active'); }

        // --- Event Listeners ---
        window.addEventListener('DOMContentLoaded', () => {
            loadCartFromLocalStorage();
            fetchProducts();
            updateCart();
        });
        window.addEventListener('hashchange', handleRouteChange);

        cartBtn.addEventListener('click', () => cartOverlay.classList.add('active'));
        closeCart.addEventListener('click', () => cartOverlay.classList.remove('active'));
        cartItems.addEventListener('click', handleCartActions);
        
        checkoutBtn.addEventListener('click', checkout);
        userBtn.addEventListener('click', showDetailsForm);
        closeDetails.addEventListener('click', closeDetailsForm);
        shippingForm.addEventListener('submit', saveShippingDetails);

        // Mobile Menu Listeners
        mobileMenuBtn.addEventListener('click', () => {
            mainNav.classList.add('active');
        });

        closeNavBtn.addEventListener('click', () => {
            mainNav.classList.remove('active');
        });

        // Dropdown click listener for mobile
        const dropdowns = document.querySelectorAll('.nav .dropdown .dropbtn');
        dropdowns.forEach(dropbtn => {
            dropbtn.addEventListener('click', (e) => {
                if (window.innerWidth <= 768) {
                    e.preventDefault();
                    const dropdown = dropbtn.parentElement;
                    dropdown.classList.toggle('active');
                }
            });
        });

        // --- MODIFIED: Curiosity Cards Logic ---
        const curiosityFacts = [
            "¿Sabías que un perfume puede tener hasta 200 ingredientes diferentes?",
            "El perfume más antiguo del mundo se encontró en Chipre y data de hace más de 4.000 años.",
            "Los egipcios fueron los primeros en incorporar el perfume en su cultura, tanto para rituales como para uso personal.",
            "Los perfumes se componen de notas de salida, de corazón y de fondo.",
            "El almizcle, un ingrediente común, hoy en día es casi siempre sintético para proteger a los animales.",
            "La capacidad de oler se relaciona directamente con las emociones y la memoria. ¡Un aroma puede transportarte al pasado!",
            "La palabra 'perfume' proviene del latín 'per fumum', que significa 'a través del humo'.",
            "El ámbar gris, un ingrediente muy valorado, es una sustancia producida por los cachalotes.",
            "El jazmín y la rosa son dos de las flores más utilizadas en la perfumería fina.",
            "El clima influye en cómo se percibe un perfume. En ambientes cálidos, las fragancias se evaporan más rápido.",
            "La piel de cada persona reacciona diferente a un perfume, por eso huele distinto en cada uno.",
            "Los frascos de perfume solían ser obras de arte, tan valiosos como la fragancia que contenían.",
            "Un perfumista, o 'nariz', puede tardar años en crear una fragancia perfecta.",
            "Existen perfumes creados para oler a lugares o experiencias, como 'olor a libro viejo' o 'noche lluviosa'.",
            "Las fragancias cítricas se asocian con la energía, mientras que las amaderadas evocan sofisticación."
        ];

        const curiosityCardContainer = document.getElementById('curiosity-card-container');
        const curiosityCardText = curiosityCardContainer.querySelector('.card-text');
        let lastFactIndex = -1;

        function showRandomFact() {
            // 1. Pick a random fact
            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * curiosityFacts.length);
            } while (randomIndex === lastFactIndex && curiosityFacts.length > 1);
            curiosityCardText.textContent = curiosityFacts[randomIndex];
            lastFactIndex = randomIndex;

            // 2. Define possible positions (corners of the screen)
            const positions = [
                { top: '100px', left: '20px', right: 'auto', bottom: 'auto' }, // Top-left (100px to avoid header)
                { top: '100px', right: '20px', left: 'auto', bottom: 'auto' }, // Top-right
                { bottom: '100px', left: '20px', top: 'auto', right: 'auto' },  // Bottom-left (to avoid FAB)
                { bottom: '100px', right: '20px', top: 'auto', left: 'auto' }  // Bottom-right
            ];
            const randomPosition = positions[Math.floor(Math.random() * positions.length)];
            
            // Reset styles before applying new ones
            curiosityCardContainer.style.top = randomPosition.top;
            curiosityCardContainer.style.bottom = randomPosition.bottom;
            curiosityCardContainer.style.left = randomPosition.left;
            curiosityCardContainer.style.right = randomPosition.right;

            // 3. Make the card visible
            curiosityCardContainer.classList.add('visible');

            // 4. Set a timer to hide the card after a few seconds
            setTimeout(() => {
                curiosityCardContainer.classList.remove('visible');
            }, 8000); // Card stays visible for 8 seconds
        }

        // Initial call and interval
        window.addEventListener('load', () => {
            if (curiosityFacts.length > 0) {
                // Show the first card after a short delay
                setTimeout(showRandomFact, 5000);
                // Set the interval for all subsequent cards
                setInterval(showRandomFact, 20000); // Show a new card every 20 seconds
            }
        });
    </script>
</body>
</html>