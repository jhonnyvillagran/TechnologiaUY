<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechnologiaUY - Tienda Gamer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ... TU CSS ORIGINAL VA AQUÍ ... (lo he omitido para que la respuesta sea más corta, pero no lo borres de tu archivo) */
        :root{--primary:#00f7ff;--primary-dark:#00c6cc;--secondary:#ff00c8;--accent:#ff8c00;--dark:#0a0a14;--darker:#05050a;--light:#f0f0f0;--success:#00ff9d;--warning:#ffcc00;--danger:#ff0055;--transition:all 0.3s ease;--shadow:0 0 10px rgba(0, 247, 255, 0.5);--shadow-lg:0 0 20px rgba(0, 247, 255, 0.7);--border-radius:8px;--bg-primary:#0a0a14;--bg-secondary:#121220;--text-primary:#f0f0f0;--text-secondary:#a0a0c0}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Segoe UI',system-ui,-apple-system,sans-serif;line-height:1.6;color:var(--text-primary);background-color:var(--bg-primary);overflow-x:hidden;transition:background-color .3s,color .3s}.container{width:90%;max-width:1200px;margin:0 auto}a{text-decoration:none;color:inherit}ul{list-style:none}img{max-width:100%;display:block}.btn{display:inline-block;padding:12px 24px;border:none;border-radius:var(--border-radius);cursor:pointer;font-weight:600;transition:var(--transition);text-align:center;font-size:1rem;position:relative;overflow:hidden;box-shadow:var(--shadow)}.btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:.5s}.btn:hover::before{left:100%}.btn-primary{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:var(--dark);border:1px solid var(--primary)}.btn-primary:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}.btn-secondary{background-color:var(--secondary);color:#fff;border:1px solid var(--secondary)}.btn-secondary:hover{background-color:#d400a8;transform:translateY(-2px);box-shadow:0 0 15px rgba(255,0,200,.7)}.btn-accent{background-color:var(--accent);color:#fff;border:1px solid var(--accent)}.btn-accent:hover{background-color:#e67e00;transform:translateY(-2px);box-shadow:0 0 15px rgba(255,140,0,.7)}.btn-outline{background:transparent;border:2px solid var(--primary);color:var(--primary)}.btn-outline:hover{background:var(--primary);color:var(--dark);box-shadow:var(--shadow-lg)}.btn-success{background-color:var(--success);color:var(--dark);border:1px solid var(--success)}.btn-success:hover{background-color:#00e68a;box-shadow:0 0 15px rgba(0,255,157,.7)}.btn-danger{background-color:var(--danger);color:#fff;border:1px solid var(--danger)}.btn-danger:hover{background-color:#e6004c;box-shadow:0 0 15px rgba(255,0,85,.7)}.header{position:fixed;top:0;left:0;width:100%;background-color:rgba(10,10,20,.95);box-shadow:var(--shadow);z-index:1000;padding:15px 0;backdrop-filter:blur(10px);transition:background-color .3s,box-shadow .3s;border-bottom:1px solid rgba(0,247,255,.3)}.header .container{display:flex;justify-content:space-between;align-items:center}.logo h1{font-size:1.8rem;font-weight:800;background:linear-gradient(90deg,var(--primary),var(--secondary));-webkit-background-clip:text;background-clip:text;color:transparent;text-shadow:0 0 10px rgba(0,247,255,.5)}.logo h1 span{font-weight:800}.nav ul{display:flex;gap:30px}.nav a{font-weight:600;position:relative;padding:5px 0;color:var(--text-primary);transition:color .3s}.nav a:hover{color:var(--primary);text-shadow:0 0 8px rgba(0,247,255,.7)}.nav a::after{content:'';position:absolute;bottom:0;left:0;width:0;height:2px;background:linear-gradient(90deg,var(--primary),var(--secondary));transition:var(--transition)}.nav a:hover::after{width:100%}.header-actions{display:flex;gap:15px;align-items:center}.cart-btn,.admin-btn,.user-btn,.theme-btn{background:none;border:none;font-size:1.3rem;cursor:pointer;position:relative;color:var(--text-primary);transition:var(--transition);width:45px;height:45px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:1px solid rgba(0,247,255,.3)}.cart-btn:hover,.admin-btn:hover,.user-btn:hover,.theme-btn:hover{color:var(--dark);background:linear-gradient(135deg,var(--primary),var(--primary-dark));transform:scale(1.1);box-shadow:var(--shadow-lg)}.cart-count{position:absolute;top:-5px;right:-5px;background:var(--danger);color:#fff;font-size:.7rem;width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;border:1px solid var(--dark)}.user-info{display:flex;align-items:center;gap:10px;color:var(--text-primary);font-weight:600}.user-info .user-name{display:none}.hero{height:100vh;background:linear-gradient(rgba(10,10,20,.9),rgba(10,10,20,.95)),url(https://images.unsplash.com/photo-1550745165-9bc0b252726f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1740&q=80);background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;text-align:center;color:#fff;margin-top:70px;position:relative;overflow:hidden}.hero::before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at center,transparent 0,rgba(10,10,20,.95) 100%);z-index:1}.hero-content{max-width:800px;padding:0 20px;z-index:2;position:relative}.hero-title{font-size:3.5rem;margin-bottom:20px;animation:slideInUp 1s ease;text-shadow:0 0 15px rgba(0,247,255,.7);font-weight:800;background:linear-gradient(90deg,var(--primary),var(--secondary));-webkit-background-clip:text;background-clip:text;color:transparent}.hero-subtitle{font-size:1.5rem;margin-bottom:30px;animation:slideInUp 1s ease .2s both;text-shadow:0 0 10px rgba(0,247,255,.5);font-weight:500;color:var(--light)}.hero-btn{animation:fadeIn 1.5s ease .4s both;margin:0 10px}.products{padding:80px 0;background-color:var(--bg-primary);transition:background-color .3s}.section-title{text-align:center;font-size:2.5rem;margin-bottom:50px;position:relative;color:var(--text-primary);font-weight:700;text-shadow:0 0 10px rgba(0,247,255,.5)}.section-title::after{content:'';position:absolute;bottom:-15px;left:50%;transform:translateX(-50%);width:80px;height:4px;background:linear-gradient(90deg,var(--primary),var(--secondary));border-radius:2px}.products-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:30px}.product-card{background:var(--bg-secondary);border-radius:var(--border-radius);overflow:hidden;box-shadow:var(--shadow);transition:var(--transition);animation:fadeIn .5s ease;position:relative;border:1px solid rgba(0,247,255,.2)}.product-card:hover{transform:translateY(-10px);box-shadow:var(--shadow-lg);border-color:rgba(0,247,255,.5)}.product-badge{position:absolute;top:15px;right:15px;background:var(--danger);color:#fff;padding:5px 10px;border-radius:20px;font-size:.8rem;font-weight:600;z-index:2;box-shadow:0 0 8px rgba(255,0,85,.5)}.product-carousel{position:relative;height:250px;overflow:hidden}.carousel-container{display:flex;transition:transform .5s ease;height:100%}.carousel-slide{min-width:100%;height:100%}.carousel-slide img{width:100%;height:100%;object-fit:cover}.carousel-nav{position:absolute;bottom:15px;left:50%;transform:translateX(-50%);display:flex;gap:8px}.carousel-dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,.3);cursor:pointer;transition:background .3s;border:1px solid var(--primary)}.carousel-dot.active{background:var(--primary);box-shadow:0 0 8px rgba(0,247,255,.7)}.carousel-btn{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,.7);color:var(--primary);border:1px solid var(--primary);width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:var(--transition);z-index:2}.carousel-btn:hover{background:rgba(0,247,255,.2);box-shadow:0 0 10px rgba(0,247,255,.5)}.carousel-btn.prev{left:15px}.carousel-btn.next{right:15px}.product-info{padding:20px}.product-title{font-size:1.3rem;margin-bottom:10px;color:var(--text-primary);font-weight:700}.product-description{color:var(--text-secondary);margin-bottom:15px;font-size:.9rem;min-height:60px}.product-price{font-size:1.5rem;font-weight:700;color:var(--primary);margin-bottom:15px;text-shadow:0 0 8px rgba(0,247,255,.5)}.product-actions{display:flex;gap:10px}.btn-add-cart{flex:1;background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:var(--dark);border:none;padding:10px;border-radius:var(--border-radius);cursor:pointer;transition:var(--transition);font-weight:600;display:flex;align-items:center;justify-content:center;gap:8px;box-shadow:var(--shadow);border:1px solid var(--primary)}.btn-add-cart:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}.admin-actions{display:none;gap:10px}.admin-actions.visible{display:flex}.btn-edit,.btn-delete{width:40px;height:40px;border-radius:50%;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:var(--transition)}.btn-edit{background-color:var(--success);color:var(--dark);border:1px solid var(--success)}.btn-delete{background-color:var(--danger);color:#fff;border:1px solid var(--danger)}.btn-edit:hover,.btn-delete:hover{transform:scale(1.1);box-shadow:0 0 10px currentColor}.cart-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:flex-end;z-index:2000;opacity:0;visibility:hidden;transition:var(--transition)}.cart-overlay.active{opacity:1;visibility:visible}.cart{background:var(--bg-primary);width:100%;max-width:450px;height:100%;display:flex;flex-direction:column;transform:translateX(100%);transition:transform .3s ease;box-shadow:-5px 0 25px rgba(0,247,255,.3);border-left:1px solid rgba(0,247,255,.3)}.cart-overlay.active .cart{transform:translateX(0)}.cart-header{padding:20px;border-bottom:1px solid rgba(0,247,255,.3);display:flex;justify-content:space-between;align-items:center;background:linear-gradient(90deg,var(--dark),#1a1a2e);color:#fff}.close-cart{background:none;border:none;font-size:2rem;cursor:pointer;color:#fff;transition:var(--transition);width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-cart:hover{background:rgba(255,255,255,.1);color:var(--primary)}.cart-items{flex:1;overflow-y:auto;padding:20px}.cart-item{display:flex;gap:15px;padding:15px 0;border-bottom:1px solid rgba(0,247,255,.1)}.cart-item-image{width:80px;height:80px;border-radius:var(--border-radius);overflow:hidden;flex-shrink:0;border:1px solid rgba(0,247,255,.2)}.cart-item-image img{width:100%;height:100%;object-fit:cover}.cart-item-details{flex:1}.cart-item-title{font-weight:600;margin-bottom:5px;color:var(--text-primary)}.cart-item-price{color:var(--primary);font-weight:700;margin-bottom:10px;text-shadow:0 0 5px rgba(0,247,255,.5)}.cart-item-actions{display:flex;align-items:center;gap:10px}.quantity-btn{width:30px;height:30px;border-radius:50%;border:1px solid rgba(0,247,255,.3);background:var(--bg-secondary);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--transition);font-weight:700;color:var(--text-primary)}.quantity-btn:hover{background:rgba(0,247,255,.1);color:var(--primary);box-shadow:0 0 8px rgba(0,247,255,.3)}.quantity{font-weight:600;min-width:30px;text-align:center;color:var(--text-primary)}.remove-item{background:none;border:none;color:var(--danger);cursor:pointer;font-size:1.2rem;transition:var(--transition)}.remove-item:hover{transform:scale(1.2);text-shadow:0 0 8px rgba(255,0,85,.7)}.cart-footer{padding:20px;border-top:1px solid rgba(0,247,255,.3)}.cart-total{font-size:1.3rem;margin-bottom:20px;text-align:right;color:var(--text-primary);font-weight:700;text-shadow:0 0 8px rgba(0,247,255,.5)}.cart-actions{display:flex;flex-direction:column;gap:10px}.auth-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:2000;opacity:0;visibility:hidden;transition:var(--transition)}.auth-overlay.active{opacity:1;visibility:visible}.auth-panel{background:var(--bg-primary);width:100%;max-width:500px;border-radius:var(--border-radius);overflow:hidden;transform:scale(.8);transition:transform .3s ease;box-shadow:0 20px 50px rgba(0,247,255,.3);border:1px solid rgba(0,247,255,.3)}.auth-overlay.active .auth-panel{transform:scale(1)}.auth-header{padding:20px;background:linear-gradient(90deg,var(--dark),#1a1a2e);color:#fff;display:flex;justify-content:space-between;align-items:center}.close-auth{background:none;border:none;font-size:2rem;cursor:pointer;color:#fff;transition:var(--transition);width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center}.close-auth:hover{background:rgba(255,255,255,.1);color:var(--primary)}.auth-content{padding:30px}.auth-tabs{display:flex;margin-bottom:20px;border-bottom:1px solid rgba(0,247,255,.3)}.auth-tab{flex:1;text-align:center;padding:15px;cursor:pointer;font-weight:600;color:var(--text-secondary);transition:var(--transition)}.auth-tab.active{color:var(--primary);border-bottom:3px solid var(--primary);text-shadow:0 0 8px rgba(0,247,255,.5)}.auth-form{display:none}.auth-form.active{display:block}.form-group{margin-bottom:15px}.form-group label{display:block;margin-bottom:8px;font-weight:600;color:var(--text-primary)}.form-group input,.form-group textarea,.form-group select{width:100%;padding:12px 15px;border:1px solid rgba(0,247,255,.3);border-radius:var(--border-radius);font-family:inherit;font-size:1rem;transition:var(--transition);background:var(--bg-secondary);color:var(--text-primary)}.form-group input:focus,.form-group textarea:focus,.form-group select:focus{border-color:var(--primary);outline:0;box-shadow:0 0 0 3px rgba(0,247,255,.2)}.about{padding:80px 0;background:var(--bg-secondary);text-align:center;border-top:1px solid rgba(0,247,255,.1);border-bottom:1px solid rgba(0,247,255,.1)}.about-content{max-width:800px;margin:0 auto;padding:0 20px}.about-title{font-size:2.5rem;margin-bottom:30px;color:var(--text-primary);text-shadow:0 0 10px rgba(0,247,255,.5)}.about-text{font-size:1.1rem;line-height:1.8;color:var(--text-secondary);margin-bottom:30px}.highlight{color:var(--primary);font-weight:600;text-shadow:0 0 8px rgba(0,247,255,.5)}.whatsapp-btn{position:fixed;bottom:30px;right:30px;width:60px;height:60px;background:#25d366;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:2rem;box-shadow:0 0 20px rgba(37,211,102,.7);z-index:100;animation:pulse 2s infinite;border:none;cursor:pointer;transition:var(--transition)}.whatsapp-btn:hover{transform:scale(1.1);box-shadow:0 0 30px rgba(37,211,102,.9)}.footer{background:var(--dark);color:var(--text-secondary);padding:20px 0;text-align:center;border-top:1px solid rgba(0,247,255,.1)}@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes slideInUp{from{transform:translateY(30px);opacity:0}to{transform:translateY(0);opacity:1}}@keyframes pulse{0%{transform:scale(1);box-shadow:0 0 0 0 rgba(37,211,102,.7)}70%{transform:scale(1.1);box-shadow:0 0 0 15px rgba(37,211,102,0)}100%{transform:scale(1);box-shadow:0 0 0 0 rgba(37,211,102,0)}}@media (max-width:768px){.nav ul{display:none}.hero-title{font-size:2.5rem}.hero-subtitle{font-size:1.2rem}.section-title{font-size:2rem}.products-grid{grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}.admin-panel,.auth-panel{margin:20px;max-width:calc(100% - 40px)}.cart{max-width:100%}.user-info .user-name{display:inline}.whatsapp-btn{width:50px;height:50px;font-size:1.5rem;bottom:20px;right:20px}}.notification{position:fixed;bottom:20px;right:20px;background-color:var(--success);color:var(--dark);padding:15px 25px;border-radius:var(--border-radius);box-shadow:0 5px 15px rgba(0,0,0,.3);z-index:3000;opacity:0;transform:translateY(20px);transition:all .3s ease;display:flex;align-items:center;gap:10px;font-weight:500;border:1px solid var(--success)}.notification.show{opacity:1;transform:translateY(0)}.notification.error{background-color:var(--danger);color:#fff;border-color:var(--danger)}.notification.warning{background-color:var(--warning);color:var(--dark);border-color:var(--warning)}.placeholder{color:#64748b;text-align:center;padding:20px}.placeholder i{font-size:2rem;margin-bottom:10px;color:#475569}
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <h1>Technologia<span>UY</span></h1>
            </div>
            <nav class="nav">
                <ul>
                    <li><a href="#inicio">Inicio</a></li>
                    <li><a href="#productos">Productos</a></li>
                    <li><a href="#nosotros">Nosotros</a></li>
                </ul>
            </nav>
            <div class="header-actions">
                <button class="cart-btn" id="cart-btn">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count">0</span>
                </button>
                <button class="user-btn" id="user-btn">
                    <i class="fas fa-user"></i>
                </button>
                <div class="user-info" id="user-info" style="display: none;">
                    <span class="user-name" id="user-name"></span>
                    <button class="btn btn-outline" id="logout-btn">Salir</button>
                </div>
                <!-- Botón de Admin Eliminado -->
            </div>
        </div>
    </header>

    <!-- Hero Section mejorado -->
    <section class="hero" id="inicio">
        <div class="hero-content">
            <h2 class="hero-title">TECNOLOGÍA AL MÁXIMO</h2>
            <p class="hero-subtitle">Los mejores productos tecnológicos al mejor precio en Uruguay</p>
            <div>
                <a href="#productos" class="btn btn-primary hero-btn">Ver Productos</a>
                <a href="#nosotros" class="btn btn-outline hero-btn">Sobre Nosotros</a>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section class="about" id="nosotros">
        <div class="about-content">
            <h2 class="about-title">Sobre TechnologiaUY</h2>
            <p class="about-text">
                Somos una empresa uruguaya basada en <span class="highlight">Rivera</span> especializada en la importación 
                y venta de productos tecnológicos de alta calidad. Nos dedicamos a brindar a nuestros clientes 
                <span class="highlight">los mejores precios del mercado</span> sin sacrificar la calidad y el servicio. 
                Nuestro compromiso es ofrecer tecnología accesible para todos, con garantía y soporte técnico especializado.
            </p>
        </div>
    </section>

    <!-- Productos Section -->
    <section class="products" id="productos">
        <div class="container">
            <h2 class="section-title">Nuestros Productos</h2>
            <div class="products-grid" id="products-container">
                <!-- Los productos se cargarán aquí dinámicamente -->
            </div>
        </div>
    </section>

    <!-- Carrito de Compras -->
    <div class="cart-overlay" id="cart-overlay">
        <div class="cart">
            <div class="cart-header">
                <h3>Tu Carrito</h3>
                <button class="close-cart" id="close-cart">&times;</button>
            </div>
            <div class="cart-items" id="cart-items"></div>
            <div class="cart-footer">
                <div class="cart-total">
                    <strong>Total: $<span id="cart-total">0.00</span></strong>
                </div>
                <div class="cart-actions">
                    <button class="btn btn-primary" id="checkout-btn">Proceder al Pago</button>
                    <button class="btn btn-secondary" id="continue-shopping">Seguir Comprando</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Panel de Autenticación -->
    <div class="auth-overlay" id="auth-overlay">
        <div class="auth-panel">
            <div class="auth-header">
                <h3>Acceso a tu cuenta</h3>
                <button class="close-auth" id="close-auth">&times;</button>
            </div>
            <div class="auth-content">
                <div class="auth-tabs">
                    <div class="auth-tab active" data-tab="login">Iniciar Sesión</div>
                    <div class="auth-tab" data-tab="register">Registrarse</div>
                </div>
                
                <!-- Formulario de Inicio de Sesión -->
                <form class="auth-form active" id="login-form">
                    <div class="form-group">
                        <label for="login-email">Email:</label>
                        <input type="email" id="login-email" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Contraseña:</label>
                        <input type="password" id="login-password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Iniciar Sesión</button>
                </form>
                
                <!-- Formulario de Registro (MODIFICADO) -->
                <form class="auth-form" id="register-form">
                    <div class="form-group">
                        <label for="register-name">Nombre Completo:</label>
                        <input type="text" id="register-name" required>
                    </div>
                    <div class="form-group">
                        <label for="register-email">Email:</label>
                        <input type="email" id="register-email" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password">Contraseña:</label>
                        <input type="password" id="register-password" required>
                    </div>
                    <div class="form-group">
                        <label for="register-cedula">Cédula de Identidad (sin puntos ni guiones):</label>
                        <input type="text" id="register-cedula" required>
                    </div>
                    <div class="form-group">
                        <label for="register-direccion">Dirección Completa (Calle, Número, Ciudad, Depto):</label>
                        <input type="text" id="register-direccion" required>
                    </div>
                    <div class="form-group">
                        <label for="register-agencia">Agencia de Envío de Preferencia:</label>
                        <input type="text" id="register-agencia" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Registrarse</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Panel de Administración Eliminado -->

    <!-- Botón de WhatsApp -->
    <button class="whatsapp-btn" id="whatsapp-btn">
        <i class="fab fa-whatsapp"></i>
    </button>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>© 2023 TechnologiaUY. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script>
        // ¡¡¡IMPORTANTE!!! PEGA AQUÍ LA URL DE TU SCRIPT DE GOOGLE SHEETS
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxR7zyKdQpDkjfgIpsF-sxwBJLRj7L0j0GC21AKgFx7tSY_aAwaCZMIL-GdaPCzrhLj/exec';

        let products = [];
        let currentUser = null;
        let cart = [];

        // Elementos del DOM (simplificado)
        const productsContainer = document.getElementById('products-container');
        const cartBtn = document.getElementById('cart-btn');
        const cartOverlay = document.getElementById('cart-overlay');
        const closeCart = document.getElementById('close-cart');
        const cartItems = document.getElementById('cart-items');
        const cartTotal = document.getElementById('cart-total');
        const cartCount = document.querySelector('.cart-count');
        const userBtn = document.getElementById('user-btn');
        const userInfo = document.getElementById('user-info');
        const userName = document.getElementById('user-name');
        const logoutBtn = document.getElementById('logout-btn');
        const authOverlay = document.getElementById('auth-overlay');
        const closeAuth = document.getElementById('close-auth');
        const authTabs = document.querySelectorAll('.auth-tab');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const checkoutBtn = document.getElementById('checkout-btn');

        // --- Cargar Productos ---
        async function fetchProducts() {
            try {
                const response = await fetch(SCRIPT_URL);
                if (!response.ok) throw new Error(`Error HTTP: ${response.status}`);
                products = await response.json();
                renderProducts();
            } catch (error) {
                showNotification('Error al cargar productos.', 'error');
                productsContainer.innerHTML = "<p>No se pudieron cargar los productos.</p>";
            }
        }

        // --- Renderizar Productos ---
        function renderProducts() {
            productsContainer.innerHTML = '';
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                // El HTML interno es igual, pero sin los botones de admin
                productCard.innerHTML = `
                    <div class="product-badge">Nuevo</div>
                    <div class="product-carousel">...</div> <!-- Simplificado -->
                    <div class="product-info">
                        <h3 class="product-title">${product.name}</h3>
                        <p class="product-description">${product.description}</p>
                        <div class="product-price">$${parseFloat(product.price).toFixed(2)}</div>
                        <div class="product-actions">
                            <button class="btn-add-cart" data-id="${product.id}">
                                <i class="fas fa-shopping-cart"></i> Agregar
                            </button>
                        </div>
                    </div>`;
                // Rellenar el carrusel...
                const carouselContainer = productCard.querySelector('.product-carousel');
                if (product.images && product.images.length > 0 && product.images[0]) {
                     carouselContainer.innerHTML = `<div class="carousel-container">${product.images.map(img => `<div class="carousel-slide"><img src="${img}" alt="${product.name}"></div>`).join('')}</div>`;
                } else {
                     carouselContainer.innerHTML = `<div class="placeholder"><i class="fas fa-image"></i><p>Sin imagen</p></div>`;
                }

                productsContainer.appendChild(productCard);
            });
            // Añadir eventos a los botones de "Agregar al carrito"
            document.querySelectorAll('.btn-add-cart').forEach(button => {
                button.addEventListener('click', () => addToCart(button.dataset.id));
            });
        }
        
        // --- Lógica de Registro de Usuario (MODIFICADA) ---
        async function registerUser(e) {
            e.preventDefault();
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const cedula = document.getElementById('register-cedula').value;
            const direccion = document.getElementById('register-direccion').value;
            const agencia = document.getElementById('register-agencia').value;

            showNotification('Registrando...', 'warning');
            
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'registerUser', name, email, password, cedula, direccion, agencia }),
                    headers: { 'Content-Type': 'application/json' }
                });
                const result = await response.json();

                if (result.status === 'success') {
                    currentUser = result.user;
                    updateUIForUser();
                    closeAuthForm();
                    showNotification(`¡Bienvenido, ${currentUser.name}!`, 'success');
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        // --- Lógica de Login de Usuario (MODIFICADA) ---
        async function loginUser(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            showNotification('Iniciando sesión...', 'warning');

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'loginUser', email, password }),
                    headers: { 'Content-Type': 'application/json' }
                });
                const result = await response.json();

                if (result.status === 'success') {
                    currentUser = result.user;
                    updateUIForUser();
                    closeAuthForm();
                    showNotification(`¡Hola de nuevo, ${currentUser.name}!`, 'success');
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        // --- Resto de funciones (sin cambios importantes) ---
        function logoutUser() {
            currentUser = null;
            updateUIForUser();
            showNotification('Has cerrado sesión.', 'success');
        }

        function updateUIForUser() {
            if (currentUser) {
                userBtn.style.display = 'none';
                userInfo.style.display = 'flex';
                userName.textContent = currentUser.name;
            } else {
                userBtn.style.display = 'flex';
                userInfo.style.display = 'none';
            }
        }

        function showNotification(message, type = 'success') {
            const el = document.createElement('div');
            el.className = `notification ${type}`;
            el.innerHTML = `<span>${message}</span>`;
            document.body.appendChild(el);
            setTimeout(() => el.classList.add('show'), 10);
            setTimeout(() => {
                el.classList.remove('show');
                setTimeout(() => document.body.removeChild(el), 300);
            }, 3000);
        }

        function addToCart(productId) {
            const product = products.find(p => p.id == productId);
            if (!product) return;
            const existingItem = cart.find(item => item.id == productId);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            updateCart();
            showNotification(`${product.name} agregado al carrito`, 'success');
        }

        function updateCart() {
            cartCount.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
            if (cart.length === 0) {
                cartItems.innerHTML = '<p>Tu carrito está vacío</p>';
                cartTotal.textContent = '0.00';
                return;
            }
            let total = 0;
            cartItems.innerHTML = cart.map(item => {
                total += item.price * item.quantity;
                return `
                    <div class="cart-item" data-id="${item.id}">
                        <img src="${item.images[0]}" width="50" alt="${item.name}">
                        <div>
                            <h4>${item.name}</h4>
                            <p>$${item.price}</p>
                            <div>
                                <button class="quantity-btn decrease">-</button>
                                <span>${item.quantity}</span>
                                <button class="quantity-btn increase">+</button>
                                <button class="remove-item">X</button>
                            </div>
                        </div>
                    </div>`;
            }).join('');
            cartTotal.textContent = total.toFixed(2);
        }

        function handleCartActions(e) {
            const target = e.target;
            const itemEl = target.closest('.cart-item');
            if (!itemEl) return;
            const id = itemEl.dataset.id;

            if (target.classList.contains('increase')) {
                cart.find(item => item.id == id).quantity++;
            } else if (target.classList.contains('decrease')) {
                let item = cart.find(item => item.id == id);
                item.quantity--;
                if(item.quantity === 0) cart = cart.filter(item => item.id != id);
            } else if (target.classList.contains('remove-item')) {
                cart = cart.filter(item => item.id != id);
            }
            updateCart();
        }
        
        function redirectToWhatsApp() {
            if (!currentUser) {
                showNotification('Por favor, inicia sesión para proceder.', 'warning');
                showAuthForm();
                return;
            }
            if (cart.length === 0) {
                showNotification('Tu carrito está vacío.', 'warning');
                return;
            }
            // Aquí puedes construir un mensaje más detallado usando los datos del currentUser si los trajeras en el login
            let message = `Hola, mi nombre es ${currentUser.name}. Quiero confirmar mi pedido:\n`;
            message += cart.map(item => `- ${item.name} (x${item.quantity})`).join('\n');
            message += `\n\nMis datos de envío están registrados con el email: ${currentUser.email}`;
            
            window.open(`https://wa.me/59895596779?text=${encodeURIComponent(message)}`, '_blank');
        }
        
        function showAuthForm(){ authOverlay.classList.add('active'); }
        function closeAuthForm(){ authOverlay.classList.remove('active'); }
        function switchAuthTab(tabName) {
            authTabs.forEach(t => t.classList.toggle('active', t.dataset.tab === tabName));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.toggle('active', f.id === `${tabName}-form`));
        }

        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            if (!SCRIPT_URL || SCRIPT_URL === 'URL_DE_TU_SCRIPT_AQUI') {
                showNotification('Error: Falta configurar la URL del script.', 'error');
                return;
            }
            fetchProducts();
            updateCart();
        });

        cartBtn.addEventListener('click', () => cartOverlay.classList.add('active'));
        closeCart.addEventListener('click', () => cartOverlay.classList.remove('active'));
        cartItems.addEventListener('click', handleCartActions);
        checkoutBtn.addEventListener('click', redirectToWhatsApp);
        userBtn.addEventListener('click', showAuthForm);
        closeAuth.addEventListener('click', closeAuthForm);
        logoutBtn.addEventListener('click', logoutUser);
        authTabs.forEach(tab => tab.addEventListener('click', () => switchAuthTab(tab.dataset.tab)));
        loginForm.addEventListener('submit', loginUser);
        registerForm.addEventListener('submit', registerUser);

    </script>
</body>
</html>